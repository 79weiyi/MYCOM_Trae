# 实现方案一：使用INI文件替代注册表保存设置

## 1. 功能需求

- 将设置保存方式从注册表改为INI文件
- 确保INI文件与程序同目录
- 支持中文编码
- 添加错误检查机制
- 确保设置能正确保存和读取
- 与现有代码兼容

## 2. 实现方案

### 2.1 修改MainWindow构造函数
- 将QSettings构造方式改为使用INI文件
- 设置UTF-8编码
- 加载设置时添加错误检查

### 2.2 修改saveSettings函数
- 将QSettings构造方式改为使用INI文件
- 设置UTF-8编码
- 保存设置后添加同步操作，确保写入文件
- 添加错误检查

### 2.3 预期效果
- 程序启动时从config.ini读取设置
- 默认勾选时间戳和日志模式
- 修改设置后自动保存到config.ini
- 重启程序后设置保持不变
- 与Enigma Virtual Box等打包工具兼容

## 3. 代码修改点

### 3.1 修改MainWindow构造函数
```cpp
// 原代码
QSettings settings("QtSerialTool", "Config");

// 修改为
QSettings settings("config.ini", QSettings::IniFormat);
settings.setIniCodec("UTF-8");
```

### 3.2 修改saveSettings函数
```cpp
// 原代码
QSettings settings("QtSerialTool", "Config");

// 修改为
QSettings settings("config.ini", QSettings::IniFormat);
settings.setIniCodec("UTF-8");
settings.setValue("timestamp", checkBox_timestamp->isChecked());
settings.setValue("logMode", checkBox_logMode->isChecked());
settings.setValue("hexReceive", checkBox_hexReceive->isChecked());
settings.setValue("hexSend", checkBox_hexSend->isChecked());
settings.sync(); // 强制写入文件
```

## 4. 实现步骤

1. 修改mainwindow.cpp中的MainWindow构造函数
2. 修改mainwindow.cpp中的saveSettings函数
3. 编译测试
4. 验证设置保存和读取功能
5. 验证与打包工具的兼容性

## 5. 注意事项

- 确保INI文件使用UTF-8编码，支持中文
- 添加sync()操作确保设置立即写入文件
- 保持与现有代码的兼容性
- 确保INI文件保存在程序当前目录
- 测试不同打包方式下的兼容性

## 6. 预期结果

- 程序启动时正确加载设置
- 默认勾选时间戳和日志模式
- 设置修改后正确保存到INI文件
- 重启程序后设置保持不变
- 与Enigma Virtual Box等打包工具兼容
- 支持中文设置值
- 无注册表权限问题