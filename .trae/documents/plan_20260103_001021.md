# 实现日志模式显示功能

## 1. 功能设计

### 1.1 日志模式定义
- 将串口数据以结构化日志格式显示
- 支持区分发送(TX)和接收(RX)数据
- 与现有十六进制显示和时间戳功能兼容
- 日志格式：`[yyyy-MM-dd HH:mm:ss] [TX/RX] 数据内容`

### 1.2 功能特性
- ✅ 可切换日志模式开关
- ✅ 自动区分发送和接收数据
- ✅ 支持十六进制显示
- ✅ 支持时间戳显示
- ✅ 保持现有功能不变

## 2. 实现方案

### 2.1 修改 mainwindow.h
- 添加日志模式复选框成员变量

### 2.2 修改 mainwindow.cpp
1. **initUI() 方法**
   - 在接收选项中添加"日志模式"复选框
   - 设置默认状态为未选中

2. **readData() 方法**
   - 添加日志模式处理逻辑
   - 当日志模式开启时，显示结构化日志
   - 格式：`[时间戳] [RX] 数据内容`

3. **on_pushButton_send_clicked() 方法**
   - 添加日志显示逻辑
   - 当日志模式开启时，显示发送日志
   - 格式：`[时间戳] [TX] 数据内容`

4. **信号槽连接**
   - 为日志模式复选框添加状态变化处理

## 3. 代码修改点

### 3.1 mainwindow.h
```cpp
// 在UI组件部分添加
QCheckBox *checkBox_logMode;
```

### 3.2 mainwindow.cpp

#### 3.2.1 initUI() 方法
```cpp
// 在接收选项布局中添加日志模式复选框
checkBox_logMode = new QCheckBox("日志模式", groupBox_receive);
horizontalLayout_receiveOptions->addWidget(checkBox_logMode);
```

#### 3.2.2 readData() 方法
```cpp
// 在现有时间戳处理后添加日志模式处理
if (checkBox_logMode->isChecked()) {
    displayText = "[RX] " + displayText;
}
```

#### 3.2.3 on_pushButton_send_clicked() 方法
```cpp
// 在发送数据后添加日志显示
if (checkBox_logMode->isChecked()) {
    QString logText;
    if (checkBox_hexSend->isChecked()) {
        logText = byteArrayToHexString(sendData);
    } else {
        logText = text;
    }
    if (checkBox_timestamp->isChecked()) {
        QDateTime currentTime = QDateTime::currentDateTime();
        QString timestamp = currentTime.toString("[yyyy-MM-dd HH:mm:ss] ");
        logText = timestamp + logText;
    }
    logText = "[TX] " + logText;
    plainTextEdit_receive->insertPlainText(logText + "\n");
    plainTextEdit_receive->moveCursor(QTextCursor::End);
}
```

## 4. 预期效果

- 用户可以通过复选框切换日志模式
- 开启日志模式后，所有数据将以结构化格式显示
- 区分发送和接收数据
- 与现有功能兼容
- 提高数据可读性和分析效率

## 5. 实现步骤

1. 修改 mainwindow.h，添加日志模式复选框成员变量
2. 修改 mainwindow.cpp 的 initUI() 方法，添加日志模式复选框
3. 修改 readData() 方法，实现接收数据的日志格式
4. 修改 on_pushButton_send_clicked() 方法，实现发送数据的日志显示
5. 编译测试功能完整性

## 6. 注意事项

- 确保日志模式与现有功能兼容
- 保持代码结构清晰
- 添加适当的注释
- 测试不同组合下的显示效果